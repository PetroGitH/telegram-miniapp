<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UtF-8">
    <title>CBd'ouFirst</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            background:black;
            color: #22c55e;
            font-family: Arial;
            text-align: center;
            padding: 20px;
        }
    button{
        width: 100%;
        padding: 15px;
        margin: 10px 0;
        font-size: 16px;
        border-radius: 10px;
        border: none;
        background: #22c55e;
        color: black;
    }
    </style>
</head>
<body>
    
<h2>CBd'OUFirst</h2>
<div1>Bonjour, 
 service de livraison Tabac,
 acessoires fumeur et CBD 
 de 9h-23h pre-commande 5,30€ offert</div1>
<button onclick="commander()"> COMMANDE </button>
<button onclick="openMenu()"> Menu </button>
<button onclick="openSnap()"> Snapchat </button>
<button onclick="contact()">Contact </button>
<button onclick="sav()">SAV </button>


<script>
const tg = window.Telegram.Webapp
tg.expand;

let panier = []; //sac de course
let fraisLivraison = 7; //cout de livraison

/*----------------------Menu Princpal -----------*/

function openMenu() {
    document.body.innerHTML=`
    <h2> Menu CBD'ouFirst </h2>
    
    <div>
        Fleur CBD - 5€/g
        <button onclick="addToCart('Fleur CBD',5)">Ajouter</button>
    </div>
    
    <div>
        résine - 7€/g
        <button onclick="addToCart('Résine,7')">Ajouter</button>
    </div>
    
    <br>
    <button onclick="showCart()> Voir le panier</button>
    <button onclick="goHome()"> Retour</button>
    `;
}
/*-------------------PANIER--------------*/

function showCart(){
    let total = 0;
    let html =`<h2> Ton panier</h2><ul>`;

    panier.forEach((item, index) => {
        total += item.prix;
        html +=`
            <li>${item.nom} - ${item.prix}€
                <button onclick="removItem(${index})">X</button>
            </li>
        `;
        
    });

    html +=`</ul>
        <h3> Total : ${total + fraisLivraison}€ </h3>
        <p>Livraison : ${fraisLivraison}€</p>
        <button onclick="askAdress()">Commander</button>
        <button onclick="openMenu()"> Retour</button>
    `;
    document.body.innerHTML = html;

}

function removeItem(index) {
    panier.splice(index, 1);
    showCart();

}

/*-------------------- LIVRAISON------------*/


function caclculLivraison(ville) {
    const zones = {
        "paris": 7,
        };
        ville = ville.toLowerCase()
        fraisLivraison =zones[ville]  || 7;
}

function askAdress() {
    document.body.innerHTML = `
        <h2> Adresse de livraison<\h2>

        <input id="nom" placeholder="Nom et prenom"/><br><br>
        <input id="adresse" placeholder="Adresse complète"/><br><br>
        <input id="code etage" placeholder="Code etage"/><br><br>
        <input id="code" placeholder="Code postal"/><br><br>
        <input id="ville" placeholder="Ville" oninput="calculLivraison(this.value)"/><br><br>
        <input id="tel" placeholder="Telephone"/><br><br>

        <button onclick="sendOrder()"> Confirmer commande</button>
        <button onclick="showCart()"> Retour</button>
    `;
} 
/*----------------------ENVOI COMMANDE AU BOT---------------*/

function sendOrder() {
    const data = {
        action: "COMMANDE",
        panier: panier,
        livraison: fraisLivraison,
        adresse: {
            nom: document.getElementById('Name').value,
            adresse: document.getElementById("adresse").value,
            codeeta: document.getElementById("code etage").value,
            code: document.getElementById('code').value,
            ville: document.getElementById('ville').value,
            tel: document.getElementById("tel").value
        }
    };
}
    tg.sendData(JSON.stringify(data));
    tg.showAlert("Commande envoyée");

function openSnap() {
    window.open("https://snapchat.com/add/wilexx3-16", "_blank");
}

function contact() {
    window.open("https://t.me/PetroGitH", "_blank");
}

function sav() {
    tg.showAlert("SAV: reponse sous 10 minutes");
    tg.sendData("ACTION_SAV");
}

function goHome(){
    location.reload();
}


</script>

</body>
</html> 

